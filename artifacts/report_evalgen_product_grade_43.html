
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Grade AutoMetric Report Card</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  
  <style>
    body.dark-mode { background-color: #121212; color: #e0e0e0; }
    body.dark-mode .card { background-color: #1e1e1e; border-color: #333; color: #e0e0e0; }
    body.dark-mode .table, body-dark-mode .table td { background-color: #1e1e1e; color: #e0e0e0; border-color: #333; }
  </style>
  <script>const RC_CORR = {}; const RC_RUNTIME = {}; const RC_ROB = {"available": false};</script>
</head>
<body>
  <div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>Grade AutoMetric Report Card</h1>
      <div class="d-flex align-items-center">
        <div class="form-check form-switch me-3">
          <input class="form-check-input" type="checkbox" id="darkModeToggle">
          <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
        </div>
        <button class="btn btn-primary" onclick="window.print()">Export to PDF</button>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Regression Coefficients</h2>
          <table class="table table-striped"><thead><tr><th>Metric</th><th>Coeff.</th></tr></thead>
            <tbody><tr><td>evalgen_product_grade_Qwen3-32B_optimized_seed43</td><td>0.1365</td></tr><tr><td>SEO_Optimization_Qwen3-32B</td><td>0.1198</td></tr><tr><td>grade_Qwen3-32B_examples</td><td>0.1183</td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Correlation</h2>
          <div id="correlation-chart" style="height:420px;"></div>
          <div id="correlation-stats" class="mt-2" style="text-align:center; font-size: 1rem; font-weight: 600;"></div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Robustness <sup><span class="robust-tip text-primary" data-tip-id="robustness-tip-template" style="cursor:pointer; text-decoration: underline; font-size: 0.9rem;">?</span></sup></h2>
          <div id="robustness-sens" style="height:240px;"></div>
          <div id="robustness-stab" style="height:240px;"></div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Run Time Distribution</h2>
          <div id="runtime-chart" style="height:300px;"></div>
          <p id="runtime-info" class="mt-2"></p>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Metric Details</h2>
          <div class="accordion" id="metricDetails">
            <div class="accordion-item">
              <h2 class="accordion-header" id="descHeader"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#descPanel">Descriptions</button></h2>
              <div id="descPanel" class="accordion-collapse collapse"><div class="accordion-body"><ul><li><strong>evalgen_product_grade_Qwen3-32B_optimized_seed43:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">MIPROv2-optimized LLM judge for grade on evalgen_product</pre></div></li>
<li><strong>SEO_Optimization_Qwen3-32B:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">**SEO Optimization** Strategic inclusion of keywords (e.g., product names, key features) to improve search engine visibility.</pre></div></li>
<li><strong>grade_Qwen3-32B_examples:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">Example-based llm as a judge metric for 'grade'.  The original task description for the task we are evaluating is: You are an expert copywriter. You need to write an e-commerce product description based on the product details and customer reviews. Your description should be SEO-optimized. It should use an active voice and include the product's features, benefits, unique selling points without overpromising, and a call to action for the buyer. Benefits describe how product features will work for the buyer, addressing exactly how the product will improve their lives. Clearly distinguish between features (e.g., lightweight, USB-chargeable) and benefits (e.g., convenience, nutritious drinks on-the-go). Don't mention weaknesses of the product or use generic or repetitive language. Don't make up review text or quotes. Don't include any links. Don't cite the reviews too heavily. Divide your description into readable chunks divided by relevant subheadings. Keep your description around 200 words, no more than 300, in Markdown format.</pre></div></li></ul></div></div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="usageHeader"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#usagePanel">Usage</button></h2>
              <div id="usagePanel" class="accordion-collapse collapse"><div class="accordion-body"><ul><li><strong>evalgen_product_grade_Qwen3-32B_optimized_seed43:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Domain:** Text Generation (E-commerce Content)
- **Tasks:** 
  - E-commerce Product Description Writing
  - SEO Content Optimization
  - Content Structuring
  - Feature-Benefit Differentiation
  - Markdown Formatting Compliance
- **Best Suited For:** 
  - For content that requires systematic verification of multiple technical writing elements
- **Not Recommended For:** 
  - When the task involves ambiguous or open-ended evaluation criteria beyond the provided rubric</pre></div></li>
<li><strong>SEO_Optimization_Qwen3-32B:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Domain:** Text Generation (E-commerce Content)
- **Tasks:** 
  - Generate SEO-optimized product descriptions with strategic keyword integration
  - Evaluate keyword placement effectiveness in e-commerce copy
  - Assess readability and structure of SEO-focused content
  - Analyze alignment of product features/benefits with target keywords
  - Verify compliance with SEO guidelines (e.g., meta descriptions, alt text)
- **Best Suited For:** 
  - When precise keyword targeting is critical for search visibility
  - For structured content requiring clear subheadings and scannable formats
  - When balancing SEO requirements with natural-sounding product benefits
  - In scenarios needing concise, high-impact calls-to-action aligned with keywords
  - For evaluating active voice usage and keyword repetition avoidance
- **Not Recommended For:** 
  - When evaluating highly technical products requiring specialized domain knowledge
  - For tasks involving creative or artistic SEO content beyond standard e-commerce needs
  - When assessing multilingual SEO requirements outside the model's training data
  - In cases requiring analysis of competitor backlink profiles or technical SEO metrics
  - For evaluating content with heavy reliance on specific regional search trends</pre></div></li>
<li><strong>grade_Qwen3-32B_examples:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Domain:** Text Generation (E-commerce Content)
- **Tasks:** 
  - Generate SEO-optimized product descriptions
  - Differentiate between product features and benefits in writing
  - Structure content with subheadings and readable chunks
  - Incorporate active voice and calls to action
  - Avoid generic language and overpromising
- **Best Suited For:** 
  - When clear examples of high-quality product descriptions exist
  - For tasks requiring strict adherence to formatting and tone guidelines
  - When SEO optimization and keyword integration are critical
  - When distinguishing features vs. benefits is a key requirement
  - For standardized product categories with predictable content needs
- **Not Recommended For:** 
  - When product details are highly ambiguous or subjective
  - For tasks requiring extreme creativity beyond example templates
  - When optimization examples are insufficient or low-quality
  - For niche products with unique requirements not covered in examples
  - When the task requires dynamic adaptation to real-time market trends</pre></div></li></ul></div></div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="limitsHeader"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#limitsPanel">Limitations</button></h2>
              <div id="limitsPanel" class="accordion-collapse collapse"><div class="accordion-body"><ul><li><strong>evalgen_product_grade_Qwen3-32B_optimized_seed43:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Biases:** 
  - Preference for high-frequency SEO keywords over contextual relevance
  - Assumption that longer descriptions inherently score higher on 'grade'
  - Bias toward active voice even when passive voice improves clarity
  - Overemphasis on subheadings as a structural requirement for all products
  - Optimization is based on training data which may not represent all use cases or edge scenarios
- **Task Misalignment Risks:** 
  - Judging 'grade' based on keyword density rather than holistic SEO effectiveness
  - Confusing feature/benefit distinction with generic marketing language requirements
  - Misinterpreting the 'grade' scale as a binary pass/fail rather than a nuanced spectrum
  - Prioritizing markdown formatting compliance over content quality assessment
  - MIPROv2 optimization may overfit to the specific training examples and generalize poorly to different domains
- **Failure Cases:** 
  - Assigning low grades to descriptions with unconventional but effective structures
  - Rewarding repetitive language disguised as SEO optimization
  - Failing to detect fabricated review references in the output
  - Penalizing concise, well-structured descriptions that meet word limits
  - Inconsistently applying the feature/benefit distinction across product categories
  - Optimized prompts may be sensitive to changes in the underlying LLM model or version</pre></div></li>
<li><strong>SEO_Optimization_Qwen3-32B:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Biases:** 
  - Overemphasis on high-frequency keywords at the expense of semantic coherence or user intent alignment.
  - Bias toward keyword stuffing due to training on older SEO content with less emphasis on natural language.
  - Potential regional keyword bias if the model’s training data is skewed toward non-target markets.
  - Underestimation of long-tail keywords in favor of generic, short-tail terms.
- **Task Misalignment Risks:** 
  - Focusing solely on keyword metrics (e.g., keyword count) rather than evaluating how well keywords align with user search intent.
  - Ignoring structural SEO elements (e.g., subheadings, bullet points) that improve both SEO and readability.
  - Assessing SEO in isolation without considering how content integrates with broader e-commerce goals (e.g., conversion rates).
  - Overlooking the importance of mobile-first content structure for modern SEO practices.
- **Failure Cases:** 
  - Generated descriptions may include irrelevant or overly repetitive keywords that harm user experience and search rankings.
  - Failure to incorporate brand-specific or product-unique keywords, leading to generic, low-differentiation content.
  - Misjudging keyword placement (e.g., overloading early paragraphs) that disrupts natural content flow and readability.
  - Omission of critical SEO elements like schema-ready structured data or missing opportunities for semantic keyword clustering.</pre></div></li>
<li><strong>grade_Qwen3-32B_examples:</strong><div class="mt-2"><pre style="white-space: pre-wrap; background:#f8f9fa; padding:8px; border-radius:6px;">- **Biases:** 
  - Overemphasis on SEO keywords at the expense of natural language flow
  - Bias toward example-based structures, limiting creative adaptation
  - Prioritization of feature enumeration over benefit articulation
  - Assumption that all products require the same subheading hierarchy
  - Tendency to favor active voice even when passive voice is contextually appropriate
- **Task Misalignment Risks:** 
  - Failure to distinguish between product features and benefits as required
  - Ignoring the 200-300 word constraint due to example-based length normalization
  - Over-reliance on customer reviews without proper contextual integration
  - Misapplication of markdown formatting rules (e.g., improper heading levels)
  - Inadequate call-to-action due to template-based output generation
- **Failure Cases:** 
  - Generated description exceeds 300 words due to verbose example replication
  - Use of passive voice in key selling points despite active voice requirement
  - Fabricated review citations disguised as generic benefit statements
  - Missing subheadings causing poor readability despite explicit formatting instructions
  - Repetitive language patterns from example overfitting</pre></div></li></ul></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100">
          <h2>Compute Requirements</h2>
          <table class="table table-striped"><thead><tr><th>Metric</th><th>GPU RAM (MB)</th><th>CPU RAM (MB)</th></tr></thead>
            <tbody><tr><td>evalgen_product_grade_Qwen3-32B_optimized_seed43</td><td>--</td><td>--</td></tr><tr><td>SEO_Optimization_Qwen3-32B</td><td>--</td><td>--</td></tr><tr><td>grade_Qwen3-32B_examples</td><td>--</td><td>--</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="mt-5 card p-3">
      <h3>Metric Summary</h3>
      <p>The aggregate regression metric evaluates e-commerce product descriptions by weighting technical writing quality, SEO optimization, and structural compliance. It emphasizes clear feature-benefit differentiation, active voice, and markdown formatting (13.65%), while prioritizing strategic keyword placement and readability for search visibility (11.98%). An example-based judge ensures adherence to task constraints like word count and subheadings (11.83%). Strengths include systematic evaluation of SEO and formatting, but limitations arise from overemphasis on keyword density, formatting rigidity, and potential biases toward training data. The metric is ideal for standardized product descriptions but may underperform for niche or highly creative content. Overfitting risks exist for SEO-focused components, which could prioritize keyword repetition over user intent alignment. Overall, it provides a balanced yet domain-specific assessment of e-commerce copy quality.</p>
    </div>

    <div class="mt-4 card p-3">
      <h3>Examples</h3>
      
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
  <script>
    function getThemeLayout() {
      const color = getComputedStyle(document.body).color;
      return { paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color } };
    }
    document.getElementById('darkModeToggle').addEventListener('change',e=>{document.body.classList.toggle('dark-mode',e.target.checked); drawAll();});
    // Enable tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (el) {
      const tip = new bootstrap.Tooltip(el, {trigger: 'hover focus', delay: {show: 0, hide: 50}, placement: 'right'});
      el.addEventListener('shown.bs.tooltip', function () {
        try { if (window.MathJax && MathJax.typesetPromise) { MathJax.typesetPromise(); } } catch(_) {}
      });
      return tip;
    });

    // Initialize tooltips; use template content for robustness
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.robust-tip').forEach(function (el) {
        const id = el.getAttribute('data-tip-id');
        let titleHtml = '';
        if (id) {
          const tpl = document.getElementById(id);
          if (tpl) titleHtml = tpl.innerHTML;
        }
        if (!titleHtml) {
          titleHtml = '<div style="max-width: 320px">Robustness tooltip unavailable.</div>';
        }
        const tip = new bootstrap.Tooltip(el, {
          trigger: 'hover focus',
          delay: {show: 0, hide: 50},
          placement: 'right',
          html: true,
          title: titleHtml
        });
      });
    });

    function drawCorrelation() {
      const layout = Object.assign({xaxis:{title:'Metric Score (normalized to target scale)'}, yaxis:{title:'Ground Truth'}}, getThemeLayout());
      layout.legend = layout.legend || {}; layout.legend.font = { size: 9 }; layout.margin = {l:40,r:10,t:30,b:40};
      const traces = [];
      if (RC_CORR.metrics) {
        // Determine top 3 metrics by absolute coefficient if available
        let topNames = [];
        try {
          const coeffPairs = ([["evalgen_product_grade_Qwen3-32B_optimized_seed43", 0.1364543504714641], ["SEO_Optimization_Qwen3-32B", 0.119786174878726], ["grade_Qwen3-32B_examples", 0.1182585448761243], ["(intercept)", 0.475]]);
          const sorted = coeffPairs.filter(p=>p[0] !== '(intercept)').sort((a,b)=>Math.abs(b[1]) - Math.abs(a[1]));
          topNames = sorted.slice(0,3).map(p=>p[0]);
        } catch (e) { topNames = []; }
        for (const m of RC_CORR.metrics) {
          const rlab = (m.r!=null ? (m.r.toFixed ? m.r.toFixed(2) : m.r) : 'NA');
          const tlab = (m.tau!=null ? (m.tau.toFixed ? m.tau.toFixed(2) : m.tau) : 'NA');
          const visible = (topNames.includes(m.name)) ? true : 'legendonly';
          const ids = m.ids || [];
          const text = ids.map(id => 'ID: ' + id);
          traces.push({ x: m.x_norm || m.x || [], y: m.y || [], mode: 'markers', name: (m.name || '') + ' (r=' + rlab + ', τ=' + tlab + ')', visible, text: text, hovertemplate: '%{text}<br>x=%{x:.3f}<br>y=%{y:.3f}<extra></extra>' });
        }
      }
      if (RC_CORR.regression) {
        const rlab = (RC_CORR.regression.r!=null ? (RC_CORR.regression.r.toFixed ? RC_CORR.regression.r.toFixed(2) : RC_CORR.regression.r) : 'NA');
        const tlab = (RC_CORR.regression.tau!=null ? (RC_CORR.regression.tau.toFixed ? RC_CORR.regression.tau.toFixed(2) : RC_CORR.regression.tau) : 'NA');
        const ids = RC_CORR.regression.ids || [];
        const text = ids.map(id => 'ID: ' + id);
        traces.push({ x: RC_CORR.regression.x_norm || RC_CORR.regression.x || [], y: RC_CORR.regression.y || [], mode: 'markers', name: (RC_CORR.regression.name || 'Aggregate') + ' (r=' + rlab + ', τ=' + tlab + ')', marker: { size: 8, color: 'black' }, text: text, hovertemplate: '%{text}<br>x=%{x:.3f}<br>y=%{y:.3f}<extra></extra>' });
        document.getElementById('correlation-stats').innerText = 'Aggregate metric: r=' + rlab + ', τ=' + tlab;
      }
      Plotly.newPlot('correlation-chart', traces, layout, {displayModeBar: false});
      // Click-to-jump: when a point is clicked, locate its ID in the examples table and jump to it
      const chart = document.getElementById('correlation-chart');
      chart.on('plotly_click', function(data) {
        try {
          if (!data || !data.points || data.points.length === 0) return;
          const pt = data.points[0];
          const idText = (pt.text || '').toString(); // format: 'ID: <val>'
          const id = idText.startsWith('ID: ') ? idText.slice(4) : idText;
          const tblEl = document.getElementById('examples-table');
          if (!tblEl) return;
          // Try DataTables jQuery API first
          if (window.jQuery && jQuery.fn && jQuery.fn.dataTable) {
            const dt = jQuery(tblEl).DataTable();
            // Search by exact match in first column (ID)
            dt.search('');
            dt.columns(0).search('^' + id.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '$', true, false).draw();
            // Scroll into view first visible row
            const rowNode = dt.row(0).node();
            if (rowNode && rowNode.scrollIntoView) rowNode.scrollIntoView({behavior:'smooth', block:'center'});
          } else if (typeof DataTable !== 'undefined') {
            // Vanilla DataTables 2 API
            const dt = DataTable.get(tblEl) || new DataTable(tblEl);
            dt.search('');
            // Filter to rows whose first cell (ID) matches
            dt.columns().every(function(idx) {
              if (idx === 0) {
                this.search('^' + id.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '$', true, false);
              } else {
                this.search('');
              }
            });
            dt.draw();
            const body = tblEl.tBodies && tblEl.tBodies[0];
            const firstRow = body && body.rows && body.rows[0];
            if (firstRow && firstRow.scrollIntoView) firstRow.scrollIntoView({behavior:'smooth', block:'center'});
          }
        } catch(e) { try { console.error('[ReportCard] click-jump failed', e); } catch(_){} }
      });
    }

    function drawRuntime() {
      const layout = Object.assign({yaxis:{title:'Time per Sample (s)'}}, getThemeLayout());
      const boxes = [];
      if (RC_RUNTIME.per_metric) {
        for (const [name, arr] of Object.entries(RC_RUNTIME.per_metric)) {
          boxes.push({ y: arr, type: 'box', name });
        }
      }
      Plotly.newPlot('runtime-chart', boxes, layout);
      if (RC_RUNTIME.aggregate) {
        const agg = RC_RUNTIME.aggregate;
        var seq = (agg.sequence_mean||0);
        if (typeof seq === 'number' && seq.toFixed) { seq = seq.toFixed(2); }
        var par = (agg.parallel_mean||0);
        if (typeof par === 'number' && par.toFixed) { par = par.toFixed(2); }
        var seqCI = (agg.sequence_ci||0);
        if (typeof seqCI === 'number' && seqCI.toFixed) { seqCI = seqCI.toFixed(2); }
        var parCI = (agg.parallel_ci||0);
        if (typeof parCI === 'number' && parCI.toFixed) { parCI = parCI.toFixed(2); }
        document.getElementById('runtime-info').innerHTML = 'Avg time/sample (sequence): ' + seq + 's ± ' + seqCI + 's' + '<br/>' + 'Avg time/sample (parallel): ' + par + 's ± ' + parCI + 's (95% CI)';
      }
    }

    function drawRobustness() {
      if (!RC_ROB.available || !RC_ROB.scores) {
        document.getElementById('robustness-sens').innerHTML = '<em>Robustness not available.</em>';
        document.getElementById('robustness-stab').innerHTML = '';
        return;
      }
      const names = Object.keys(RC_ROB.scores);
      const sens = names.map(n => (RC_ROB.scores[n] && RC_ROB.scores[n].sensitivity) || 0);
      const stab = names.map(n => (RC_ROB.scores[n] && RC_ROB.scores[n].stability) || 0);
      Plotly.newPlot('robustness-sens', [{x: names, y: sens, type:'bar', name:'Sensitivity'}], Object.assign({yaxis:{title:'Sensitivity'}}, getThemeLayout()));
      Plotly.newPlot('robustness-stab', [{x: names, y: stab, type:'bar', name:'Stability'}], Object.assign({yaxis:{title:'Stability'}}, getThemeLayout()));
    }

    function drawAll() { drawCorrelation(); drawRuntime(); drawRobustness(); }
    drawAll();
  </script>
  <script>
    (function() {
      const tbl = document.getElementById('examples-table');
      if (!tbl) return;
      try {
        if (window.jQuery && jQuery.fn && typeof jQuery.fn.dataTable !== 'undefined') {
          jQuery(tbl).DataTable({
            paging: true,
            pageLength: 5,
            ordering: true,
            searching: true,
            scrollX: true
          });
        } else if (typeof DataTable !== 'undefined') {
          new DataTable(tbl, {
            paging: true,
            pageLength: 5,
            ordering: true,
            searching: true,
            scrollX: true
          });
        }
      } catch (e) { try { console.error('[ReportCard] DataTables init error:', e); } catch(_){} }
    })();
  </script>
  <div id="robustness-tip-template" class="d-none">
    <div style="max-width: 360px">
      <strong>Sensitivity</strong> (worse_obvious): how much the metric tends to drop when the output is intentionally degraded. For each example, we measure the relative drop from the original to the average worse_obvious score, clip negative values to 0 (no drop), and then average across examples.
      <br/><br/>
      <strong>Stability</strong> (same_obvious): how consistent the metric stays under neutral edits that should not change meaning. For each example, we measure how close the original is to the average same_obvious score (scaled by the original magnitude), clip below 0, and then average across examples. Higher means more stable.
    </div>
  </div>
</body>
</html>
